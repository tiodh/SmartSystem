<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %} | Computer Vision System</title>

    <!-- Theme Detection and Primary Color Injection -->
    <script>
        (function () {
            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            }
            // Apply Theme Mode
            const theme = getCookie('theme_mode') || "{{ config.theme_mode if config else 'dark' }}";
            document.documentElement.className = theme + '-theme';

            // Apply Primary Theme Color
            const primaryColor = "{{ config.theme_color if config and config.theme_color else '#6366f1' }}";
            document.documentElement.style.setProperty('--primary', primaryColor);
        })();
    </script>

    <!-- Google Fonts: Outfit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <style>
        /* Interactive Elements */
        .btn {
            background-color: var(--primary) !important;
            color: white !important;
            /* Forced white text */
            font-weight: 800 !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn:hover {
            filter: brightness(1.15);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px -5px var(--primary);
        }

        .prediction-badge {
            border-color: var(--primary) !important;
            color: var(--primary) !important;
            background-color: var(--primary);
            background-image: linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.9));
            /* This creates a 10% opacity effect */
        }

        .theme-toggle-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .compact-file-input .file-name {
            color: var(--primary);
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>

<body class="{{ config.theme_mode if config and config.theme_mode else 'dark' }}-theme">
    <button class="theme-toggle-btn" id="theme-toggle" title="Toggle Dark/Light Mode">
        ðŸŒ™
    </button>

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <script>
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;
        const html = document.documentElement;

        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = getCookie('theme_mode');
            if (savedTheme) {
                body.className = savedTheme + '-theme';
                html.className = savedTheme + '-theme';
                themeToggle.textContent = savedTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
            } else {
                const defaultTheme = "{{ config.theme_mode if config else 'dark' }}";
                themeToggle.textContent = defaultTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
            }
        });

        themeToggle.addEventListener('click', () => {
            const isDark = body.classList.contains('dark-theme');
            const newTheme = isDark ? 'light' : 'dark';

            body.className = newTheme + '-theme';
            html.className = newTheme + '-theme';
            themeToggle.textContent = newTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';

            setCookie('theme_mode', newTheme, 30);

            // Sync with setup dropdown if it exists
            const setupSelect = document.getElementById('theme_mode');
            if (setupSelect) {
                setupSelect.value = newTheme;
            }
        });

        // For setup page real-time preview
        const setupColorPicker = document.getElementById('theme_color');
        if (setupColorPicker) {
            setupColorPicker.addEventListener('input', (e) => {
                document.documentElement.style.setProperty('--primary', e.target.value);
            });
        }
    </script>
    {% block extra_js %}{% endblock %}
</body>

</html>